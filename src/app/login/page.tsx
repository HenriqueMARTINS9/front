'use client';
import { useState } from 'react';
import { restaurantAuthService } from '@/lib/api';
import { useRouter } from 'next/navigation';
import { setRestaurantToken, setRestaurantId, extractRestaurantIdFromEmail } from '@/lib/auth';


export default function LoginPage() {
    const [email, setEmail] = useState('restaurant1@test.com');
    const [password, setPassword] = useState('');
    const [error, setError] = useState<string | null>(null);
    const router = useRouter();


    const handleLogin = async () => {
        try {
            setError(null);
            
            // Vérifier le format de l'email
            const restaurantId = extractRestaurantIdFromEmail(email);
            if (!restaurantId) {
                setError('Format d\'email invalide. Utilisez le format: restaurantX@test.com (ex: restaurant1@test.com)');
                return;
            }

            const res = await restaurantAuthService.login(email, password);

            // Stocker le token et le restaurant ID
            setRestaurantToken(res.access_token);
            setRestaurantId(res.restaurant.id);
            
            router.push('/home');
        } catch (err: any) {
            setError(err.message || 'Erreur de connexion');
        }
    };


    return (
        <div className="min-h-screen flex items-center justify-center bg-gray-50 px-4">
            <div className="w-full max-w-md bg-white shadow-lg rounded-lg p-8">
                <div className="flex justify-center mb-6">
                    {/* Placeholder logo SVG */}
                    <svg width="336" height="40" viewBox="0 0 336 40" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <g clipPath="url(#clip0_10620_41932)">
                            <path d="M65.0325 0.988771H65.0012C61.9243 0.988771 58.4466 0.988771 54.9095 0.992069C53.4923 0.992069 52.0653 0.992069 50.6498 0.995368C50.1449 0.995368 49.6417 0.995368 49.1419 0.995368C44.5439 1.37963 40.921 5.24373 40.921 9.93902C40.921 14.6343 44.5522 18.505 49.1567 18.8843C49.6467 18.8843 50.1416 18.8843 50.6366 18.8843C52.0554 18.8843 53.4874 18.8843 54.9095 18.8843C58.407 18.8876 61.8484 18.8876 64.9005 18.8876H64.9616C64.988 18.8876 65.0144 18.8876 65.0391 18.8843C69.9076 18.8118 73.8456 14.8339 73.8539 9.95056V9.92418C73.8489 5.03922 69.9076 1.05804 65.0325 0.987122V0.988771ZM65.3163 17.0405C62.8366 17.0405 60.654 15.7706 59.3837 13.846C59.0504 13.3446 58.7815 12.7971 58.5835 12.2166C58.341 11.5008 58.2107 10.7339 58.2107 9.93737C58.2107 9.1408 58.3427 8.37227 58.5852 7.65816C58.7815 7.07764 59.0504 6.53176 59.3837 6.02875C60.654 4.10412 62.835 2.83423 65.3163 2.83423C69.2394 2.83423 72.4218 6.0139 72.4218 9.93737C72.4218 13.8608 69.2411 17.0405 65.3163 17.0405Z" fill="#4E5BA6" />
                            <path d="M43.8939 18.8846H34.9686C33.921 18.845 33.4063 18.9736 32.2745 18.7724C31.1906 18.5663 30.2601 18.342 28.8644 17.7796C27.1206 17.1001 25.6655 15.8979 24.1593 14.9677C21.8842 13.5774 17.6575 13.1338 14.6615 13.1486C11.456 13.1222 7.73079 13.1371 4.71335 13.1239C3.32424 13.1206 2.18259 13.1272 1.48144 13.1156C0.991456 13.1041 0.547666 13.0117 0.346394 12.4988C0.273804 12.3521 0.255656 12.2267 0.204513 12.07C0.0411852 11.412 0.00324034 10.6682 -0.00170898 9.94092C-0.00170898 9.16744 0.0840794 8.13174 0.257306 7.62378C0.420634 6.99214 0.862774 6.7497 1.48144 6.76455C2.18094 6.753 3.32424 6.7596 4.71335 6.7563C7.73244 6.74476 11.4543 6.7596 14.6615 6.73156C17.6525 6.7464 21.8875 6.30442 24.1593 4.91578C25.6672 3.98563 27.1223 2.78336 28.8644 2.10389C30.2601 1.53986 31.1873 1.31886 32.2745 1.10941C33.106 0.975828 33.9771 0.997268 34.9686 0.997268H43.8906C40.7659 2.75532 38.6492 6.10651 38.6492 9.94092C38.6492 13.7753 40.7676 17.1265 43.8939 18.8862V18.8846Z" fill="#4E5BA6" />
                            <path d="M21.2838 30.0478V30.0742C21.292 34.9558 25.23 38.9337 30.0985 39.0079C30.1233 39.0112 30.1497 39.0112 30.176 39.0112H30.2371C33.2892 39.0112 36.7306 39.0112 40.2281 39.0079C41.6502 39.0079 43.0822 39.0079 44.5011 39.0079C44.996 39.0079 45.4893 39.0079 45.9809 39.0079C50.5854 38.6303 54.2166 34.7629 54.2166 30.0626C54.2166 25.3674 50.5937 21.5033 45.9957 21.119C45.4959 21.119 44.991 21.119 44.4879 21.119C43.0723 21.119 41.6469 21.119 40.2281 21.1157C36.691 21.1157 33.2133 21.1124 30.1365 21.1124H30.1051C25.23 21.1833 21.2887 25.1645 21.2838 30.0495V30.0478ZM22.7174 30.0593C22.7174 26.1375 25.8982 22.9562 29.823 22.9562C32.3026 22.9562 34.4853 24.2261 35.7556 26.1507C36.0888 26.6521 36.3578 27.198 36.5541 27.7785C36.7982 28.4942 36.9286 29.2628 36.9286 30.0593C36.9286 30.8559 36.7966 31.6228 36.5557 32.3386C36.3594 32.9191 36.0888 33.4666 35.7556 33.9696C34.4853 35.8942 32.3043 37.1641 29.823 37.1641C25.8998 37.1641 22.7174 33.9845 22.7174 30.061V30.0593Z" fill="#4E5BA6" />
                            <path d="M51.2437 39.0063H60.169C61.2166 38.9667 61.7313 39.0954 62.8631 38.8942C63.947 38.688 64.8775 38.4637 66.2732 37.9013C68.017 37.2219 69.4721 36.0196 70.9783 35.0894C73.2534 33.6992 77.4801 33.2555 80.4761 33.2704C83.6816 33.244 87.4068 33.2588 90.4242 33.2456C91.8134 33.2423 92.955 33.2489 93.6562 33.2374C94.1461 33.2258 94.5899 33.1335 94.7912 32.6206C94.8638 32.4738 94.8819 32.3485 94.9331 32.1918C95.0964 31.5337 95.1344 30.79 95.1393 30.0627C95.1393 29.2892 95.0535 28.2535 94.8803 27.7455C94.717 27.1139 94.2748 26.8714 93.6562 26.8863C92.9567 26.8747 91.8134 26.8813 90.4242 26.878C87.4052 26.8665 83.6833 26.8813 80.4761 26.8533C77.4851 26.8681 73.2501 26.4262 70.9783 25.0375C69.4704 24.1074 68.0153 22.9051 66.2732 22.2256C64.8775 21.6616 63.9503 21.4406 62.8631 21.2311C62.0316 21.0976 61.1605 21.119 60.169 21.119H51.247C54.3717 22.8771 56.4884 26.2282 56.4884 30.0627C56.4884 33.8971 54.37 37.2483 51.2437 39.008V39.0063Z" fill="#4E5BA6" />
                            <path d="M111.592 8.54541H116.866L123.355 27.701L129.805 8.54541H134.966L125.973 33.3528H120.623L111.592 8.54541Z" fill="#4E5BA6" />
                            <path d="M136.711 9.19024C136.711 7.44538 137.964 6.1557 139.709 6.1557C141.455 6.1557 142.707 7.44538 142.707 9.19024C142.707 10.9351 141.455 12.1869 139.709 12.1869C137.964 12.1869 136.711 10.9351 136.711 9.19024ZM137.432 14.6128H141.948V33.3511H137.432V14.6128Z" fill="#4E5BA6" />
                            <path d="M145.551 22.4647C145.551 16.8129 148.89 14.1197 153.785 14.1197C158.68 14.1197 161.981 16.8129 161.981 22.5406V22.6544H157.504V22.4647C157.504 19.4302 155.986 18.3301 153.785 18.3301C151.584 18.3301 150.066 19.4302 150.066 22.4647V33.3511H145.551V22.4647Z" fill="#4E5BA6" />
                            <path d="M163.651 26.1441V7.97644H168.166V14.6145H177.842V18.7111H168.166V26.1458C168.166 28.6493 169.456 29.6355 171.315 29.6355C173.175 29.6355 174.465 28.6872 174.465 26.1458V25.6526H178.98V26.1458C178.98 31.3424 175.869 33.8459 171.315 33.8459C166.762 33.8459 163.651 31.3424 163.651 26.1458V26.1441Z" fill="#4E5BA6" />
                            <path d="M181.105 24.3613V14.6128H185.621V24.3613C185.621 27.9269 187.518 29.6338 190.364 29.6338C193.21 29.6338 195.107 27.9269 195.107 24.3613V14.6128H199.622V24.3613C199.622 30.62 195.904 33.8442 190.364 33.8442C184.824 33.8442 181.105 30.658 181.105 24.3613Z" fill="#4E5BA6" />
                            <path d="M201.823 24.1716C201.823 18.2164 205.997 14.1197 211.954 14.1197C217.912 14.1197 221.934 18.1026 221.934 24.1337V33.3511H217.798V29.6717C216.66 32.4408 214.117 33.8442 211.158 33.8442C206.604 33.8442 201.823 30.5821 201.823 24.1716ZM217.418 23.982C217.418 20.6819 215.218 18.3301 211.916 18.3301C208.615 18.3301 206.376 20.6819 206.376 23.982C206.376 27.282 208.615 29.6338 211.916 29.6338C215.218 29.6338 217.418 27.282 217.418 23.982Z" fill="#4E5BA6" />
                            <path d="M225.539 6.42123H230.054V33.3528H225.539V6.42123Z" fill="#4E5BA6" />
                            <path d="M233.052 26.182H237.795C237.833 28.1545 239.313 29.4821 242.272 29.4821C245.232 29.4821 246.75 28.1545 246.75 26.182C246.75 24.0199 244.435 23.6027 241.741 23.1095C237.985 22.4268 233.545 21.6302 233.545 15.8646C233.545 11.2748 237.036 8.05063 242.31 8.05063C247.585 8.05063 250.886 11.1231 251.076 15.6749H246.484C246.446 13.7783 245.042 12.4128 242.348 12.4128C239.654 12.4128 238.25 13.8921 238.25 15.7128C238.25 17.875 240.565 18.2922 243.259 18.7853C247.015 19.4681 251.493 20.2647 251.493 26.0303C251.493 30.8476 247.812 33.8442 242.272 33.8442C236.732 33.8442 233.166 30.9235 233.052 26.182Z" fill="#4E5BA6" />
                            <path d="M253.125 23.982C253.125 18.2922 257.299 14.1197 263.218 14.1197C269.137 14.1197 273.311 18.2922 273.311 23.982C273.311 29.6717 269.137 33.8442 263.218 33.8442C257.299 33.8442 253.125 29.6717 253.125 23.982ZM268.718 23.982C268.718 20.6819 266.517 18.3301 263.216 18.3301C259.915 18.3301 257.676 20.6819 257.676 23.982C257.676 27.282 259.915 29.6338 263.216 29.6338C266.517 29.6338 268.718 27.282 268.718 23.982Z" fill="#4E5BA6" />
                            <path d="M275.51 22.6544C275.51 16.7749 278.925 14.1197 283.365 14.1197C286.173 14.1197 288.488 15.2956 289.854 17.4956C291.182 15.2956 293.496 14.1197 296.342 14.1197C300.782 14.1197 304.197 16.7749 304.197 22.6544V33.3511H299.681V22.6544C299.681 19.5819 298.088 18.3301 295.887 18.3301C293.686 18.3301 292.13 19.6198 292.13 22.6544V33.3511H287.615V22.6544C287.615 19.6198 285.983 18.3301 283.82 18.3301C281.657 18.3301 280.026 19.5819 280.026 22.6544V33.3511H275.51V22.6544Z" fill="#4E5BA6" />
                            <path d="M307.156 22.6544C307.156 16.7749 310.571 14.1197 315.011 14.1197C317.819 14.1197 320.134 15.2956 321.5 17.4956C322.828 15.2956 325.142 14.1197 327.988 14.1197C332.428 14.1197 335.843 16.7749 335.843 22.6544V33.3511H331.327V22.6544C331.327 19.5819 329.734 18.3301 327.533 18.3301C325.332 18.3301 323.776 19.6198 323.776 22.6544V33.3511H319.261V22.6544C319.261 19.6198 317.629 18.3301 315.466 18.3301C313.303 18.3301 311.672 19.5819 311.672 22.6544V33.3511H307.156V22.6544Z" fill="#4E5BA6" />
                        </g>
                        <defs>
                            <clipPath id="clip0_10620_41932">
                                <rect width="336" height="38.0225" fill="white" transform="translate(0 0.98877)" />
                            </clipPath>
                        </defs>
                    </svg>

                </div>
                <h1 className="title">
                    Bienvenue !
                </h1>
                <div className="space-y-8">
                    <div className="space-y-4">
                        <div className="space-y-2">
                            <p className="inputFieldBase">
                                Email
                            </p>
                            <div className="relative">
                                <span className="pointer-events-none absolute inset-y-0 left-0 pl-3.5 flex items-center text-gray-500">
                                    <svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M18.3334 3.01124C18.3334 2.09457 17.5834 1.34457 16.6667 1.34457H3.33335C2.41669 1.34457 1.66669 2.09457 1.66669 3.01124M18.3334 3.01124V13.0112C18.3334 13.9279 17.5834 14.6779 16.6667 14.6779H3.33335C2.41669 14.6779 1.66669 13.9279 1.66669 13.0112V3.01124M18.3334 3.01124L10 8.84457L1.66669 3.01124" stroke="#717680" strokeWidth="1.66667" strokeLinecap="round" strokeLinejoin="round" />
                                    </svg>

                                </span>
                                <input
                                    type="email"
                                    placeholder="restaurant1@test.com"
                                    className="input"
                                    value={email}
                                    onChange={(e) => setEmail(e.target.value)}
                                />
                            </div>
                        </div>
                        <div className="space-y-2">
                            <p className="inputFieldBase">
                                Mot de passe
                            </p>
                            <div className="relative">
                                <span className="pointer-events-none absolute inset-y-0 left-0 pl-3.5 flex items-center text-gray-500">
                                    <svg width="18" height="20" viewBox="0 0 18 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M4.83333 9.17792V5.84458C4.83333 4.73952 5.27232 3.67971 6.05372 2.89831C6.83512 2.1169 7.89493 1.67792 9 1.67792C10.1051 1.67792 11.1649 2.1169 11.9463 2.89831C12.7277 3.67971 13.1667 4.73952 13.1667 5.84458V9.17792M3.16667 9.17792H14.8333C15.7538 9.17792 16.5 9.92411 16.5 10.8446V16.6779C16.5 17.5984 15.7538 18.3446 14.8333 18.3446H3.16667C2.24619 18.3446 1.5 17.5984 1.5 16.6779V10.8446C1.5 9.92411 2.24619 9.17792 3.16667 9.17792Z" stroke="#717680" strokeWidth="1.66667" strokeLinecap="round" strokeLinejoin="round" />
                                    </svg>

                                </span>
                                <input
                                    type="password"
                                    placeholder="Password"
                                    className="input"
                                    value={password}
                                    onChange={(e) => setPassword(e.target.value)}
                                />
                            </div>
                        </div>
                    </div>
                    {error && (
                        <div className="bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded text-sm">
                            {error}
                        </div>
                    )}
                    <button
                        onClick={handleLogin}
                        className="btn w-full text-white font-medium"
                    >
                        Connexion
                    </button>
                    <p className="forgotMdp">
                        J&apos;ai oublié mon mot de passe
                    </p>
                    <div className="text-xs text-gray-500 text-center mt-2">
                        Format: restaurantX@test.com (ex: restaurant1@test.com)
                    </div>
                </div>
            </div>
        </div>
    );
}
'use client';
import { usePathname, useRouter } from 'next/navigation';
import Link from 'next/link';
import {
    Home,
    Wine,
    Utensils,
    Users,
    Settings,
} from 'lucide-react';
import { useTranslation } from '@/lib/useTranslation';
import { useRestaurantInfo } from '@/lib/hooks';
import { isRestaurantLoggedIn, clearAllTokens } from '@/lib/auth';
import LanguageSelector from './LanguageSelector';

export default function Sidebar() {
    const pathname = usePathname();
    const router = useRouter();
    const { t } = useTranslation();
    const { data: restaurantInfo } = useRestaurantInfo();
    const isRestaurant = isRestaurantLoggedIn();

    const handleLogout = () => {
        clearAllTokens();
        router.push('/login');
    };

    const nav = [
        { label: t('navigation.home'), icon: <Home className="w-4 h-4" />, href: '/home' },
        { label: t('navigation.wines'), icon: <Wine className="w-4 h-4" />, href: '/vins' },
        { label: t('navigation.menu'), icon: <Utensils className="w-4 h-4" />, href: '/menu' },
        { label: t('navigation.team'), icon: <Users className="w-4 h-4" />, href: '' },
        { label: t('navigation.settings'), icon: <Settings className="w-4 h-4" />, href: '' },
    ];
    return (
        <aside className="w-55 bg-[#363F72] text-white flex flex-col justify-between min-h-screen p-6">
            <div className='flex flex-col gap-y-12'>
                <div className='mt-6'>
                    <svg width="173" height="20" viewBox="0 0 173 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M33.484 2.28261e-06H33.4679C31.8837 2.28261e-06 30.093 2.28261e-06 28.2718 0.00170057C27.5422 0.00170057 26.8074 0.00170057 26.0786 0.00339886C25.8187 0.00339886 25.5596 0.00339886 25.3022 0.00339886C22.9348 0.20125 21.0695 2.1908 21.0695 4.60831C21.0695 7.02583 22.9391 9.01878 25.3099 9.21408C25.5621 9.21408 25.817 9.21408 26.0718 9.21408C26.8023 9.21408 27.5396 9.21408 28.2718 9.21408C30.0727 9.21578 31.8446 9.21578 33.416 9.21578H33.4475C33.4611 9.21578 33.4747 9.21578 33.4874 9.21408C35.9941 9.17672 38.0217 7.12858 38.0259 4.61426V4.60067C38.0234 2.0855 35.9941 0.0356664 33.484 -0.000846863V2.28261e-06ZM33.6301 8.26474C32.3534 8.26474 31.2296 7.61089 30.5755 6.61994C30.4039 6.3618 30.2655 6.07988 30.1635 5.78098C30.0387 5.41246 29.9716 5.0176 29.9716 4.60747C29.9716 4.19733 30.0395 3.80163 30.1644 3.43395C30.2655 3.13505 30.4039 2.85398 30.5755 2.59499C31.2296 1.60404 32.3525 0.950196 33.6301 0.950196C35.6501 0.950196 37.2886 2.58735 37.2886 4.60747C37.2886 6.62758 35.6509 8.26474 33.6301 8.26474Z" fill="#F8F9FC" />
                        <path d="M22.6002 9.21421H18.0047C17.4653 9.19383 17.2003 9.26006 16.6176 9.15646C16.0595 9.05032 15.5804 8.93484 14.8618 8.64528C13.9639 8.29543 13.2147 7.6764 12.4392 7.19748C11.2678 6.48166 9.09153 6.25324 7.54895 6.26088C5.8985 6.24729 3.98046 6.25493 2.42684 6.24814C1.71161 6.24644 1.1238 6.24984 0.762791 6.24389C0.510507 6.23795 0.282008 6.1904 0.178377 5.92631C0.141002 5.85074 0.131658 5.78621 0.105325 5.70554C0.0212309 5.36673 0.00169382 4.98376 -0.000854492 4.60929C-0.000854492 4.21104 0.0433163 3.67778 0.132507 3.41624C0.216602 3.09102 0.444251 2.96619 0.762791 2.97384C1.12295 2.96789 1.71161 2.97129 2.42684 2.96959C3.98131 2.96365 5.89765 2.97129 7.54895 2.95685C9.08899 2.9645 11.2695 2.73692 12.4392 2.02194C13.2156 1.54303 13.9648 0.923999 14.8618 0.574152C15.5804 0.283744 16.0578 0.169958 16.6176 0.0621168C17.0457 -0.00666396 17.4942 0.00437493 18.0047 0.00437493H22.5985C20.9896 0.909564 19.8998 2.63503 19.8998 4.60929C19.8998 6.58355 20.9905 8.30902 22.6002 9.21505V9.21421Z" fill="#F8F9FC" />
                        <path d="M10.9586 14.9619V14.9755C10.9629 17.489 12.9905 19.5371 15.4972 19.5754C15.5099 19.577 15.5235 19.577 15.5371 19.577H15.5685C17.14 19.577 18.9119 19.577 20.7127 19.5754C21.4449 19.5754 22.1822 19.5754 22.9128 19.5754C23.1676 19.5754 23.4216 19.5754 23.6747 19.5754C26.0455 19.3809 27.9151 17.3896 27.9151 14.9696C27.9151 12.5521 26.0497 10.5625 23.6824 10.3647C23.425 10.3647 23.165 10.3647 22.906 10.3647C22.1771 10.3647 21.4432 10.3647 20.7127 10.363C18.8915 10.363 17.1009 10.3613 15.5167 10.3613H15.5006C12.9905 10.3978 10.9612 12.4476 10.9586 14.9628V14.9619ZM11.6968 14.9679C11.6968 12.9486 13.3345 11.3106 15.3553 11.3106C16.632 11.3106 17.7558 11.9645 18.4099 12.9554C18.5815 13.2136 18.7199 13.4946 18.821 13.7935C18.9467 14.162 19.0138 14.5578 19.0138 14.9679C19.0138 15.378 18.9459 15.7729 18.8219 16.1414C18.7208 16.4403 18.5815 16.7222 18.4099 16.9812C17.7558 17.9722 16.6329 18.626 15.3553 18.626C13.3353 18.626 11.6968 16.9889 11.6968 14.9687V14.9679Z" fill="#F8F9FC" />
                        <path d="M26.3844 19.5745H30.9799C31.5193 19.5541 31.7843 19.6204 32.367 19.5168C32.9251 19.4106 33.4042 19.2951 34.1228 19.0056C35.0206 18.6557 35.7698 18.0367 36.5454 17.5578C37.7168 16.842 39.893 16.6135 41.4356 16.6212C43.0861 16.6076 45.0041 16.6152 46.5577 16.6084C47.2729 16.6067 47.8608 16.6101 48.2218 16.6042C48.474 16.5982 48.7025 16.5507 48.8062 16.2866C48.8436 16.211 48.8529 16.1465 48.8792 16.0658C48.9633 15.727 48.9829 15.3441 48.9854 14.9696C48.9854 14.5713 48.9412 14.0381 48.852 13.7765C48.768 13.4513 48.5403 13.3265 48.2218 13.3341C47.8616 13.3282 47.2729 13.3316 46.5577 13.3299C45.0032 13.3239 43.0869 13.3316 41.4356 13.3172C39.8956 13.3248 37.7151 13.0972 36.5454 12.3822C35.769 11.9033 35.0198 11.2843 34.1228 10.9345C33.4042 10.644 32.9268 10.5303 32.367 10.4224C31.9389 10.3536 31.4904 10.3647 30.9799 10.3647H26.3861C27.9949 11.2699 29.0848 12.9953 29.0848 14.9696C29.0848 16.9439 27.9941 18.6693 26.3844 19.5754V19.5745Z" fill="#F8F9FC" />
                        <path d="M57.4565 3.89078H60.1722L63.513 13.7536L66.8343 3.89078H69.4914L64.8611 16.6636H62.1064L57.4565 3.89078Z" fill="#F8F9FC" />
                        <path d="M70.3901 4.22279C70.3901 3.32439 71.0349 2.66036 71.9336 2.66036C72.8323 2.66036 73.477 3.32439 73.477 4.22279C73.477 5.12119 72.8323 5.76569 71.9336 5.76569C71.0349 5.76569 70.3901 5.12119 70.3901 4.22279ZM70.7613 7.01478H73.0863V16.6628H70.7613V7.01478Z" fill="#F8F9FC" />
                        <path d="M74.9414 11.0576C74.9414 8.14754 76.6607 6.76089 79.181 6.76089C81.7012 6.76089 83.401 8.14754 83.401 11.0966V11.1552H81.0956V11.0576C81.0956 9.49514 80.3141 8.92876 79.181 8.92876C78.0478 8.92876 77.2663 9.49514 77.2663 11.0576V16.6628H74.9414V11.0576Z" fill="#F8F9FC" />
                        <path d="M84.2606 12.952V3.59782H86.5855V7.01563H91.5675V9.1249H86.5855V12.9529C86.5855 14.2419 87.2498 14.7496 88.2071 14.7496C89.1644 14.7496 89.8287 14.2614 89.8287 12.9529V12.699H92.1536V12.9529C92.1536 15.6285 90.5516 16.9175 88.2071 16.9175C85.8627 16.9175 84.2606 15.6285 84.2606 12.9529V12.952Z" fill="#F8F9FC" />
                        <path d="M93.2477 12.0341V7.01478H95.5726V12.0341C95.5726 13.8699 96.5494 14.7488 98.0147 14.7488C99.48 14.7488 100.457 13.8699 100.457 12.0341V7.01478H102.782V12.0341C102.782 15.2566 100.867 16.9167 98.0147 16.9167C95.1623 16.9167 93.2477 15.2761 93.2477 12.0341Z" fill="#F8F9FC" />
                        <path d="M103.915 11.9364C103.915 8.87016 106.064 6.76089 109.131 6.76089C112.199 6.76089 114.27 8.81157 114.27 11.9169V16.6628H112.14V14.7683C111.554 16.194 110.245 16.9167 108.721 16.9167C106.377 16.9167 103.915 15.2371 103.915 11.9364ZM111.945 11.8388C111.945 10.1396 110.812 8.92876 109.112 8.92876C107.412 8.92876 106.259 10.1396 106.259 11.8388C106.259 13.5379 107.412 14.7488 109.112 14.7488C110.812 14.7488 111.945 13.5379 111.945 11.8388Z" fill="#F8F9FC" />
                        <path d="M116.126 2.79707H118.451V16.6636H116.126V2.79707Z" fill="#F8F9FC" />
                        <path d="M119.994 12.9715H122.436C122.456 13.9871 123.218 14.6707 124.741 14.6707C126.265 14.6707 127.047 13.9871 127.047 12.9715C127.047 11.8583 125.855 11.6435 124.468 11.3896C122.534 11.038 120.248 10.6279 120.248 7.65928C120.248 5.29611 122.045 3.63603 124.761 3.63603C127.477 3.63603 129.176 5.21799 129.274 7.56163H126.91C126.89 6.58511 126.168 5.88202 124.78 5.88202C123.393 5.88202 122.67 6.6437 122.67 7.58116C122.67 8.69439 123.862 8.90922 125.249 9.16312C127.184 9.51467 129.489 9.9248 129.489 12.8934C129.489 15.3738 127.594 16.9167 124.741 16.9167C121.889 16.9167 120.053 15.4128 119.994 12.9715Z" fill="#F8F9FC" />
                        <path d="M130.329 11.8388C130.329 8.90922 132.478 6.76089 135.526 6.76089C138.574 6.76089 140.723 8.90922 140.723 11.8388C140.723 14.7683 138.574 16.9167 135.526 16.9167C132.478 16.9167 130.329 14.7683 130.329 11.8388ZM138.358 11.8388C138.358 10.1396 137.225 8.92876 135.525 8.92876C133.825 8.92876 132.673 10.1396 132.673 11.8388C132.673 13.5379 133.825 14.7488 135.525 14.7488C137.225 14.7488 138.358 13.5379 138.358 11.8388Z" fill="#F8F9FC" />
                        <path d="M141.855 11.1552C141.855 8.12801 143.613 6.76089 145.899 6.76089C147.345 6.76089 148.537 7.36633 149.24 8.49909C149.924 7.36633 151.116 6.76089 152.581 6.76089C154.867 6.76089 156.625 8.12801 156.625 11.1552V16.6628H154.3V11.1552C154.3 9.57326 153.48 8.92876 152.346 8.92876C151.213 8.92876 150.412 9.59279 150.412 11.1552V16.6628H148.087V11.1552C148.087 9.59279 147.247 8.92876 146.134 8.92876C145.02 8.92876 144.18 9.57326 144.18 11.1552V16.6628H141.855V11.1552Z" fill="#F8F9FC" />
                        <path d="M158.149 11.1552C158.149 8.12801 159.907 6.76089 162.193 6.76089C163.639 6.76089 164.831 7.36633 165.534 8.49909C166.218 7.36633 167.41 6.76089 168.875 6.76089C171.161 6.76089 172.919 8.12801 172.919 11.1552V16.6628H170.594V11.1552C170.594 9.57326 169.773 8.92876 168.64 8.92876C167.507 8.92876 166.706 9.59279 166.706 11.1552V16.6628H164.381V11.1552C164.381 9.59279 163.541 8.92876 162.428 8.92876C161.314 8.92876 160.474 9.57326 160.474 11.1552V16.6628H158.149V11.1552Z" fill="#F8F9FC" />
                    </svg>

                </div>


                <div className="text-xl font-bold text-[#EAECF5]">
                    {isRestaurant && restaurantInfo ? restaurantInfo.name : 'MonHôtel'}
                </div>
                <div className="flex flex-col gap-y-6">

                    {nav.map((item) => {
                        const isActive = pathname === item.href;
                        return (
                            <Link
                                key={item.label}
                                href={item.href}
                                className={`flex items-center gap-2 p-2 rounded-lg text-base font-medium transition-colors
                                        ${isActive
                                        ? 'bg-[#2E3265] text-white'
                                        : 'text-white/80 hover:text-white hover:bg-white/10'
                                    }`}
                            >
                                {item.icon}
                                {item.label}
                            </Link>
                        );
                    })}

                </div>
            </div>


            <div className="space-y-4">
                {/* Sélecteur de langue */}
                <div className="">
                    <LanguageSelector />
                </div>

                {/* Section utilisateur/restaurant */}
                <div className="text-sm pt-4 flex justify-between">
                    {/*<div>
                        <div className="mb-1 font-medium">
                            {isRestaurant && restaurantInfo 
                                ? restaurantInfo.name 
                                : 'Olivia Rhye'
                            }
                        </div>
                        <div className="text-xs text-white/70">
                            {isRestaurant && restaurantInfo 
                                ? restaurantInfo.email 
                                : 'olivia@untitledui.com'
                            }
                        </div>
                    </div>*/}

                    <div 
                        className="flex items-center gap-1 text-indigo-300 cursor-pointer"
                        onClick={handleLogout}
                        title={t('common.disconnect')}  >
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M9 21H5C4.46957 21 3.96086 20.7893 3.58579 20.4142C3.21071 20.0391 3 19.5304 3 19V5C3 4.46957 3.21071 3.96086 3.58579 3.58579C3.96086 3.21071 4.46957 3 5 3H9M16 17L21 12M21 12L16 7M21 12H9" stroke="#D5D9EB" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" />
                        </svg>
                    </div>
                </div>
            </div>
        </aside>
    );
}